const {createApp,ref,computed,nextTick}=Vue;
function readInlinePlayers(){const n=document.getElementById("playersData");if(!n)return null;try{return JSON.parse(n.textContent.trim())}catch(e){return null}}
function getInitialPlayers(){const o=localStorage.getItem("playersOverride");if(o){try{return JSON.parse(o)}catch(e){return []}}const i=readInlinePlayers();if(i)return i;return []}
function downloadJSON(data,filename){const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download=filename;document.body.appendChild(a);a.click();a.remove()}
createApp({setup(){const players=ref(getInitialPlayers());const fileRef=ref(null);const nextNumber=computed(()=>players.value.length?Math.max(...players.value.map(p=>p.number||0))+1:1);function add(){players.value.push({number:nextNumber.value,name:"New Player",position:"MID",altPosition:"FWD",photo:"avatars/placeholder.jpg"});nextTick(()=>{const el=document.querySelector('#playerEditorApp tbody tr:last-child input[name="name"]');if(el)el.focus()})}function remove(i){players.value.splice(i,1)}function move(i,dir){const j=i+dir;if(j<0||j>=players.value.length)return;const t=players.value[i];players.value[i]=players.value[j];players.value[j]=t}function save(){localStorage.setItem("playersOverride",JSON.stringify(players.value));window.dispatchEvent(new CustomEvent("players-updated",{detail:players.value}));if(window.__closePlayerEditor)window.__closePlayerEditor()}function clearOverride(){localStorage.removeItem("playersOverride");window.dispatchEvent(new CustomEvent("players-updated",{detail:readInlinePlayers()||[]}));if(window.__closePlayerEditor)window.__closePlayerEditor()}function exportJSON(){downloadJSON(players.value,"players.json")}function openFile(){fileRef.value.click()}function onFile(e){const f=e.target.files[0];if(!f)return;const reader=new FileReader();reader.onload=ev=>{try{const data=JSON.parse(ev.target.result);if(Array.isArray(data)){players.value=data}}catch(_){}};reader.readAsText(f);e.target.value=""}return{players,fileRef,add,remove,move,save,exportJSON,openFile,onFile,clearOverride}},template:`<div class="pe-header"><div class="pe-title">Edit Players</div><div class="pe-actions"><button class="pe-btn blue" @click="openFile()">Import JSON</button><input ref="fileRef" type="file" accept="application/json" class="hidden" @change="onFile"/><button class="pe-btn" @click="exportJSON()">Export JSON</button><button class="pe-btn green" @click="add()">Add Player</button><button class="pe-btn" @click="save()">Save</button><button class="pe-btn red" @click="clearOverride()">Reset To Original</button><button class="pe-btn" @click="window.__closePlayerEditor()">Close</button></div></div><table class="pe-table"><thead><tr><th style="width:70px">No</th><th>Name</th><th style="width:110px">Position</th><th style="width:120px">Alt Position</th><th>Photo</th><th style="width:160px">Actions</th></tr></thead><tbody><tr v-for="(p,i) in players" :key="i" class="pe-row"><td><input class="pe-input" type="number" v-model.number="p.number" min="0"/></td><td><input class="pe-input" name="name" type="text" v-model.trim="p.name"/></td><td><select class="pe-input" v-model="p.position"><option>GK</option><option>DEF</option><option>MID</option><option>FWD</option></select></td><td><select class="pe-input" v-model="p.altPosition"><option>GK</option><option>DEF</option><option>MID</option><option>FWD</option></select></td><td><div class="pe-mini"><input class="pe-input" type="text" v-model.trim="p.photo"/><a class="pe-link" :href="p.photo" target="_blank">Preview</a></div></td><td><div class="pe-mini"><button class="pe-btn" @click="move(i,-1)">↑</button><button class="pe-btn" @click="move(i,1)">↓</button><button class="pe-btn red" @click="remove(i)">Delete</button></div></td></tr></tbody></table>`}).mount("#playerEditorApp");window.addEventListener("players-updated",e=>{if(typeof loadPlayersData==="function"){loadPlayersData.__forceOverride=e.detail}if(typeof window.refreshPlayersUI==="function"){window.refreshPlayersUI(e.detail)}});
